<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - NT SURVEY</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        body { margin: 0; padding: 0; display: flex; align-items: center; justify-content: center; min-height: 100vh; background-color: #f4f7f6; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .auth-card { width: 90%; max-width: 380px; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        h2 { text-align: center; margin-bottom: 25px; color: #2c3e50; font-size: 24px; }
        
        .input-group { position: relative; margin-bottom: 15px; }
        .input-group i { position: absolute; left: 15px; top: 15px; color: #7f8c8d; }
        .input-group input, .input-group select { 
            display: block; width: 100%; padding: 14px 14px 14px 45px; 
            box-sizing: border-box; border: 1px solid #ddd; border-radius: 8px; 
            font-size: 15px; transition: 0.3s;
        }
        .input-group input:focus, .input-group select:focus { border-color: #3498db; outline: none; }
        
        .btn { width: 100%; padding: 14px; background-color: #2c3e50; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px; margin-top: 10px; }
        .btn:hover { background-color: #1a252f; }
        
        .ref-info { font-size: 12px; color: #27ae60; margin-top: -10px; margin-bottom: 10px; display: block; }
    </style>
</head>
<body>
    <div class="auth-card">
        <h2>Create Account</h2>
        
        <div class="input-group">
            <i class="fas fa-envelope"></i>
            <input type="email" id="signupEmail" placeholder="Email Address">
        </div>

        <div class="input-group">
            <i class="fas fa-globe"></i>
            <select id="signupCountry" required>
                <option value="" disabled selected>Loading Countries...</option>
            </select>
        </div>

        <div class="input-group">
            <i class="fas fa-lock"></i>
            <input type="password" id="signupPassword" placeholder="Password">
        </div>

        <div class="input-group">
            <i class="fas fa-users"></i>
            <input type="text" id="referralCode" placeholder="Referral Code (Optional)">
        </div>
        <span class="ref-info">* Enter a code to get bonus coins.</span>

        <button class="btn" onclick="signupUser()">Create Account</button>
        
        <p style="text-align: center; margin-top: 20px;">Already have an account? <a href="login.html" style="color:#3498db; text-decoration:none;">Login</a></p>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    
    <script src="config.js"></script>

    <script>
        // ‡¶´‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ó ‡¶á‡¶Æ‡ßã‡¶ú‡¶ø ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        function getFlagEmoji(countryCode) {
            return countryCode.toUpperCase().replace(/./g, char => 
                String.fromCodePoint(char.charCodeAt(0) + 127397)
            );
        }

        // ‡¶¶‡ßá‡¶∂ ‡¶è‡¶¨‡¶Ç ‡¶´‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ó ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
        async function loadCountries() {
            const countrySelect = document.getElementById("signupCountry");
            try {
                const res = await fetch("https://restcountries.com/v3.1/all?fields=name,cca2");
                const data = await res.json();
                
                // ‡¶®‡¶æ‡¶Æ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶∏‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ
                data.sort((a, b) => a.name.common.localeCompare(b.name.common));

                countrySelect.innerHTML = '<option value="" disabled selected>Select Your Country</option>';
                data.forEach(country => {
                    const option = document.createElement("option");
                    const flag = getFlagEmoji(country.cca2);
                    option.value = country.name.common;
                    option.textContent = `${flag} ${country.name.common}`;
                    countrySelect.appendChild(option);
                });
            } catch (err) {
                countrySelect.innerHTML = '<option value="Global">üåê Global</option>';
            }
        }
        window.onload = loadCountries;

        // ‡¶∏‡¶æ‡¶á‡¶®‡¶Ü‡¶™ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (Referral ‡¶∏‡¶π)
        function signupUser() {
            const email = document.getElementById("signupEmail").value;
            const password = document.getElementById("signupPassword").value;
            const country = document.getElementById("signupCountry").value;
            const refCode = document.getElementById("referralCode").value.trim();

            if(!email || !password || !country) {
                alert("Please fill all fields");
                return;
            }

            firebase.auth().createUserWithEmailAndPassword(email, password)
            .then((userCredential) => {
                const user = userCredential.user;
                const initialBalance = 0; // ‡¶®‡¶§‡ßÅ‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡ß¶ ‡¶ï‡ßü‡ßá‡¶®

                // ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ
                const userData = {
                    uid: user.uid,
                    email: email,
                    country: country,
                    balance: initialBalance,
                    referralCode: user.uid.substring(0, 6).toUpperCase(), // ‡¶®‡¶ø‡¶ú‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡ßã‡¶° ‡¶§‡ßà‡¶∞‡¶ø
                    referredBy: refCode || "none",
                    joinedAt: Date.now()
                };

                firebase.database().ref("users/" + user.uid).set(userData).then(() => {
                    alert("Account Created Successfully!");
                    window.location.href = "dashboard.html";
                });
            })
            .catch(error => alert(error.message));
        }
    </script>
</body>
</html>
