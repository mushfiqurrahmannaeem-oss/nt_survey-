<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - NT SURVEY</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        body { margin: 0; padding: 0; display: flex; align-items: center; justify-content: center; min-height: 100vh; background-color: #f4f7f6; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .auth-card { width: 90%; max-width: 380px; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        h2 { text-align: center; margin-bottom: 25px; color: #2c3e50; font-size: 24px; }
        
        .input-group { position: relative; margin-bottom: 15px; }
        .input-group i { position: absolute; left: 15px; top: 15px; color: #7f8c8d; z-index: 5; }
        .input-group input, .input-group select { 
            display: block; width: 100%; padding: 14px 14px 14px 45px; 
            box-sizing: border-box; border: 1px solid #ddd; border-radius: 8px; 
            font-size: 15px; transition: 0.3s; background-color: white;
        }
        .input-group input:focus, .input-group select:focus { border-color: #3498db; outline: none; box-shadow: 0 0 5px rgba(52, 152, 219, 0.2); }
        
        .btn { width: 100%; padding: 14px; background-color: #2c3e50; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px; margin-top: 10px; }
        .btn:hover { background-color: #1a252f; }
        
        .ref-info { font-size: 12px; color: #27ae60; margin-top: -10px; margin-bottom: 10px; display: block; font-weight: 500; }
    </style>
</head>
<body>
    <div class="auth-card">
        <h2>Create Account</h2>
        
        <div class="input-group">
            <i class="fas fa-envelope"></i>
            <input type="email" id="signupEmail" placeholder="Email Address">
        </div>

        <div class="input-group">
            <i class="fas fa-globe"></i>
            <select id="signupCountry" required>
                <option value="" disabled selected>Loading All Countries...</option>
            </select>
        </div>

        <div class="input-group">
            <i class="fas fa-lock"></i>
            <input type="password" id="signupPassword" placeholder="Password">
        </div>

        <div class="input-group">
            <i class="fas fa-users"></i>
            <input type="text" id="referralCode" placeholder="Referral Code (Optional)">
        </div>
        <span class="ref-info"><i class="fas fa-gift"></i> Enter code for bonus coins!</span>

        <button class="btn" onclick="signupUser()">Create Account</button>
        
        <p style="text-align: center; margin-top: 20px; font-size: 14px; color: #7f8c8d;">
            Already have an account? <a href="login.html" style="color:#3498db; text-decoration:none; font-weight:bold;">Login</a>
        </p>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    
    <script src="config.js"></script>

    <script>
        //     
        function getFlagEmoji(countryCode) {
            if (!countryCode) return "";
            const codePoints = countryCode
                .toUpperCase()
                .split('')
                .map(char =>  127397 + char.charCodeAt());
            return String.fromCodePoint(...codePoints);
        }

        //       
        async function loadCountries() {
            const countrySelect = document.getElementById("signupCountry");
            try {
                // RestCountries API       
                const res = await fetch("https://restcountries.com/v3.1/all?fields=name,cca2");
                if (!res.ok) throw new Error("Network issues");
                
                const data = await res.json();
                
                //     (A to Z)
                data.sort((a, b) => a.name.common.localeCompare(b.name.common));

                countrySelect.innerHTML = '<option value="" disabled selected>Select Your Country</option>';
                
                data.forEach(country => {
                    const option = document.createElement("option");
                    const flag = getFlagEmoji(country.cca2);
                    option.value = country.name.common;
                    option.textContent = `${flag} ${country.name.common}`;
                    countrySelect.appendChild(option);
                });
            } catch (err) {
                console.error("Error loading countries:", err);
                countrySelect.innerHTML = '<option value="Global"> Global / Other</option>';
            }
        }

        //      
        window.addEventListener('DOMContentLoaded', loadCountries);

        function signupUser() {
            const email = document.getElementById("signupEmail").value;
            const password = document.getElementById("signupPassword").value;
            const country = document.getElementById("signupCountry").value;
            const refCode = document.getElementById("referralCode").value.trim();

            if(!email || !password || !country) {
                alert("Please complete all required fields!");
                return;
            }

            firebase.auth().createUserWithEmailAndPassword(email, password)
            .then((userCredential) => {
                const user = userCredential.user;
                
                const userData = {
                    uid: user.uid,
                    email: email,
                    country: country,
                    balance: 0,
                    referralCode: user.uid.substring(0, 6).toUpperCase(),
                    referredBy: refCode || "none",
                    joinedAt: Date.now()
                };

                firebase.database().ref("users/" + user.uid).set(userData).then(() => {
                    alert("Account Created Successfully!");
                    window.location.href = "dashboard.html";
                });
            })
            .catch(error => alert(error.message));
        }
    </script>
</body>
</html>
